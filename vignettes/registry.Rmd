---
title: "Registry"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Registry}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup, include=FALSE, echo=FALSE}
devtools::load_all(".")
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{css, echo=FALSE}
.dataTables_filter label {
font-size: 18px;
color: greenyellow;
}
```

This page tracks the status of competition participants as they set up their
paper traders provided by [Interactive Brokers](https://www.interactivebrokers.com/en/home.php).

Check back here often - if the account ID logged for your tradername is not
correct, respond to the Duke Fintech Trading Competition email address or post
in the Slack channel ASAP.

```{r, echo = FALSE, figures-side, fig.show="hold", out.width="50%"}
completion_plot <- tibble::tibble(
  'status' = c('READY', 'INCOMPLETE'),
  'count'  = c(
    length(which(registry$account_id != 'account pending creation')),
    length(which(registry$account_id == 'account pending creation'))
  )
) %>%
  plotly::plot_ly(
    labels = ~status, 
    textposition = 'inside',
    textinfo = 'label+percent',
    insidetextfont = list(color = '#FFFFFF'),
    values = ~count, 
    type   = 'pie',
    marker = list(
      colors     = c('rgb(132,186,91)', 'rgb(128,133,133)'),
      line       = list(color = '#FFFFFF', width = 1)
    ),
    showlegend = FALSE
  ) %>% 
  plotly::layout(
    xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
    yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
    paper_bgcolor='rgba(0,0,0,0)',
    plot_bgcolor='rgba(0,0,0,0)'
  )

by_school_plot <- school_stats %>%
  dplyr::arrange(School) %>%
  plotly::plot_ly(
    x = .$completion * 100,
    y = .$School,
    type = 'bar',
    orientation = 'h',
    height = 900
  ) %>% 
  plotly::layout(
    paper_bgcolor='rgba(0,0,0,0)',
    plot_bgcolor='rgba(0,0,0,0)',
    xaxis = list(color = 'DarkGoldenRod', ticksuffix = '%'),
    yaxis = list(color = 'GhostWhite')
  )

shiny::tagList(
  shiny::fluidRow(
    shiny::column(
      width = 4, 
      shiny::fluidRow(
        shiny::tags$h3('Overall Completion', style = 'text-align: center')
      ),
      shiny::fluidRow(completion_plot)
    ),
    shiny::column(
      
      width = 8,
      shiny::fluidRow(
        shiny::tags$h3('Completion by School', style = 'text-align: center')
      ),
      shiny::div(by_school_plot, style='height: 400px;overflow-y: scroll;')
    )
  )
)

```


```{r}

```

last updated: `r paste0(as.POSIXct(format(Sys.time()),tz="EST"), ' EST')`

### Key

#### If your tradername doesn't appear here:
You've submitted your registration form but this website hasn't yet
refreshed and picked up your updated information.

#### 'pending account creation'
You've been sent a welcome email and an IBKR paper trading account invitation.
Join the Slack channel, submit your IBKR form, and wait (about one business day)

#### An Account ID
Your account is set up and you're ready. The system has matched your tradername
to the given Account ID- you'll want to confirm that that's correct. Use the
Slack channel if there's an issue.


```{r, echo = FALSE}
DT::datatable(
  registry,
  extensions = 'Scroller', 
  rownames   = FALSE,
  options = list(
    columnDefs = list(list(className = 'dt-center', targets = '_all')),
    initComplete = DT::JS(
      "
      function(settings, json) {
          $(this.api().table().header()).css({
              'font-size' : '20px', 
              'color' : 'greenyellow'
          });
      }
      "
    ),
    deferRender = TRUE,
    ordering    = FALSE,
    scrollY     = 500,
    scroller    = TRUE
  )
)
```
