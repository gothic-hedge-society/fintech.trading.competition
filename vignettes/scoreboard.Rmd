---
title: "Scoreboard"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Scoreboard}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
devtools::load_all('.')
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(knitr.table.format = "html") 
```

```{css, echo = FALSE}
button.dt-button {
font-size: 14px;
color: greenyellow;
border: 1px solid white;
}
.dataTables_filter label{
font-size: 18px;
color: greenyellow;
}
h1, h2 {
text-align: center;
}
.intro-text {
font-size: large;
color: beige;
text-align: center;
}
.fp-title, .ee-title {
font-size: x-large;
color: white;
text-align: center;
font-weight: bold;
}
.fp-tradername {
padding-top: 16px;
font-size: xx-large;
color: greenyellow;
text-align: center;
font-weight: bold;
}
.fp-school {
font-size: x-large;
text-align: center;
}
.fp-country {
font-size: x-large;
text-align: center;
}
.fp-sharpe {
font-size: x-large;
text-align: center;
}
.update-info-row {
font-size: x-large;
text-align: center;
font-weight: bold;
}
.last-updated-time{
color: greenyellow;
}
.leaderboard {
border-style: solid;
border-color: #FFD960;
}
```

```{r echo=FALSE}
standings_dt <- standings %>%
  dplyr::select(-country) %>%
  tibble::column_to_rownames("Rank") %>%
  DT::datatable(
    .,
    extensions = c('Buttons', 'Responsive'),
    options = list(
      columnDefs   = list(
        list(className = 'dt-center', targets = '_all')
      ),
      initComplete = DT::JS(
        "
      function(settings, json) {
          $(this.api().table().header()).css({
              'font-size' : '20px', 
              'color' : 'greenyellow'
          });
      }
      "
      ),
      paging      = FALSE,
      dom         = 'Bft',
      buttons     = c('csv', 'excel', 'copy'),
      ordering    = FALSE,
      deferRender = TRUE,
      scrollY     = 200
    )
  ) %>%
  DT::formatSignif('Sharpe', 5)


sharpes_over_time <- sharpes %>%
  dplyr::select(
    sharpes[nrow(sharpes),] %>% 
      unlist() %>%
      sort(decreasing = TRUE) %>% 
      head(11) %>%
      names()
  ) %>%
  tibble::column_to_rownames("Date") %>%
  unique() %>%
  xts::as.xts() %>%
  dygraphs::dygraph(width = "100%") %>%
  dygraphs::dyOptions(
    strokeWidth = 3,
    drawPoints  = TRUE, 
    pointSize   = 7
  ) %>%
  dygraphs::dyAxis(
    "y", 
    logscale          = TRUE,
    axisLabelFontSize = 16,
    axisLabelColor    = "#FFD960",
    axisLineWidth     = 3,
    axisLineColor     = "#E89923",
  ) %>%
    dygraphs::dyAxis(
    "x", 
    logscale          = TRUE,
    axisLabelFontSize = 16,
    axisLabelColor    = "#FFD960",
    axisLineWidth     = 3,
    axisLineColor     = "#E89923"
  ) %>%
  dygraphs::dyLegend(show = "follow")

```

```{r echo=FALSE}
shiny::tagList(
  shiny::fluidRow(
    shiny::tags$p(
      shiny::tags$span(
        "Last Updated: ", 
        class = "last-updated"
      ),
      shiny::tags$span(
        lubridate::with_tz(Sys.time(), tzone = "EST"), 
        class = "last-updated-time"
      ),
      class = "update-info-row"
    )  
  ),
  shiny::fluidRow(
    shiny::tags$p(
      paste0(
        "Analysis of the 2022 Duke FINTECH Spring Trading Competition is ",
        "posted here. This section is frequently updated and expanded, so be",
        " sure to check back often!"
      ),
      class = "intro-text"
    )  
  ),
  shiny::fluidRow(
    shiny::column(
      width = 6, 
      shiny::fluidRow(
        shiny::column(
          width = 9,
          shiny::p("First Place", class = "fp-title"),
          shiny::p(standings[1,'tradername'], class = "fp-tradername"),
          shiny::p(standings[1,'school'], class = "fp-school"),
          shiny::p(standings[1,'country'], class = "fp-country"),
          shiny::p(
            paste0("Sharpe: ", signif(standings[1,'Sharpe'], 5)), 
            class = "fp-sharpe"
          ),
        )
      )
    ),
    shiny::column(
      width = 6, 
      shiny::p("Runner-Ups", class = "ee-title"),
      shiny::HTML(
        standings[2:5,] %>%
          dplyr::mutate(
            "Sharpe" = signif(Sharpe, 5)
          ) %>%
          kableExtra::kbl(align="rcccc") %>%
          kableExtra::kable_minimal() %>%
          kableExtra::row_spec(
            0, color = "greenyellow"
          ) %>%
          kableExtra::column_spec(
            1,
            extra_css = "font-weight:bold; color:#FFD960;"
          ) %>%
          kableExtra::column_spec(
            1:5,
            extra_css = "vertical-align:middle;"
          )
      )
    ),
    class = "leaderboard"
  )
)
```

<!-- # Top Sharpe Ratios Over Time -->

<!-- ```{r echo=FALSE} -->
<!-- shiny::fluidRow( -->
<!--   sharpes_over_time, -->
<!--   class = "sharpes-over-time" -->
<!-- ) -->
<!-- ``` -->
<!-- Need to use a log axis because Hoppity and Bubbles' Sharpe ratios are so high! -->

# Full Ranking
```{r echo=FALSE}
standings_dt
```
